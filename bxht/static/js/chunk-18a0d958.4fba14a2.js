(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-18a0d958"],{"0369":function(e,t,i){"use strict";function a(e){return window.open(Object({NODE_ENV:"production",VUE_APP_CONFIG:"static/config.json",BASE_URL:""}).VUE_APP_BASE_API+"/export/"+e)}i.d(t,"a",(function(){return a}))},"09f4":function(e,t,i){"use strict";i.d(t,"a",(function(){return s})),Math.easeInOutQuad=function(e,t,i,a){return e/=a/2,e<1?i/2*e*e+t:(e--,-i/2*(e*(e-2)-1)+t)};var a=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)}}();function o(e,t){document.getElementsByClassName(e)[0].scrollTop=t}function n(e){if(e)return document.getElementsByClassName(e)[0].scrollTop;console.error("scrollTo缺少el对象")}function s(e,t,i,s){var r=n(e),l=t-r;if(0!==l){var c=20,d=0;i="undefined"===typeof i?500:i;var u=function t(){d+=c;var n=Math.easeInOutQuad(d,r,l,i);o(e,n),d<i?a(t):s&&"function"===typeof s&&s()};u()}}},"0bbd":function(e,t,i){},"1c82":function(e,t,i){},3639:function(e,t,i){e.exports=i.p+"static/img/mark.47a90cb3.png"},"55be":function(e,t,i){"use strict";i("0bbd")},"62b3":function(e,t,i){"use strict";i.d(t,"a",(function(){return o})),i.d(t,"c",(function(){return n})),i.d(t,"b",(function(){return s}));var a=i("b775");function o(e){return Object(a["a"])({url:"/AdminServlet",method:"post",data:e})}function n(e){return Object(a["a"])({url:"/AdminServlet",method:"post",data:{op:"selallqy",xq:e}})}function s(e){return Object(a["a"])({url:"/AdminServlet",method:"post",data:{op:"selbxdbyadmin",bid:e}})}},"88b37":function(e,t,i){"use strict";i("96d2")},"8e84":function(e,t,i){"use strict";i.r(t);var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"main pad10",staticStyle:{width:"100%",height:"100%"}},[i("div",{ref:"mainHeader",staticClass:"main-header"},[i("span",{staticClass:"title"},[e._v("校区")]),e._v(" "),i("el-select",{attrs:{clearable:"",placeholder:"请选择校区",disabled:"qrcode"===e.showType},on:{change:e.handleCampusChange},model:{value:e.xq,callback:function(t){e.xq=t},expression:"xq"}},e._l(e.campus,(function(e){return i("el-option",{key:e.value,attrs:{label:e.text,value:e.value}})})),1),e._v(" "),"img"===e.showType||"qrcode"===e.showType?[i("span",{staticClass:"title"},[e._v("区域")]),e._v(" "),i("el-select",{attrs:{"popper-class":"main-header-select",clearable:"",filterable:"",placeholder:"请选择区域"},model:{value:e.qy,callback:function(t){e.qy=t},expression:"qy"}},e._l(e.region,(function(e,t){return i("el-option",{key:t,attrs:{label:e.qy,value:e.id}})})),1)]:e._e(),e._v(" "),"img"===e.showType||"qrcode"===e.showType?i("el-button",{attrs:{type:"primary",icon:"el-icon-search"},on:{click:function(t){return e.getQrcode(e.qy)}}},[e._v("查看二维码\n      ")]):e._e(),e._v(" "),"img"===e.showType?i("el-button",{attrs:{type:"success",icon:"el-icon-search"},on:{click:e.showAreaList}},[e._v("查看所有区域列表\n      ")]):e._e(),e._v(" "),"img"===e.showType?i("el-switch",{staticStyle:{margin:"0 10px"},attrs:{"active-text":"自动监控"},on:{change:e.handleMonitorSwitch},model:{value:e.switchAutoMonior,callback:function(t){e.switchAutoMonior=t},expression:"switchAutoMonior"}}):e._e(),e._v(" "),"img"===e.showType&&e.switchAutoMonior?i("span",{staticStyle:{"font-size":"14px",color:"#9e9e9e"}},[e._v("("+e._s(e.config.qygltime)+"s自动刷新)")]):e._e(),e._v(" "),"qrcode"===e.showType?i("el-button",{attrs:{type:"success",icon:"el-icon-plus"},on:{click:e.addQrcode}},[e._v("新建二维码")]):e._e(),e._v(" "),"qrcode"===e.showType||"area"===e.showType?i("el-button",{staticClass:"fr",attrs:{type:"primary",plain:"",icon:"el-icon-back"},on:{click:e.handleBack}},[e._v("返回\n      ")]):e._e()],2),e._v(" "),i("div",{ref:"mainContent",staticClass:"main-content",staticStyle:{height:"100%",width:"100%"},on:{mousewheel:function(t){return e.onMousewheel(t)}}},[i("div",{staticStyle:{position:"relative",width:"100%",height:"100%"}},[i("div",{staticClass:"image-tips"},[i("el-tag",{attrs:{type:"primary"}},[e._v("\n            *提示：图片区域范围内鼠标右键新建区域\n          ")])],1),e._v(" "),i("div",{staticClass:"image-recovery"},[i("el-button",{attrs:{type:"danger",round:"",size:"small",icon:"el-icon-refresh"},on:{click:e.resetImageView}},[e._v("重置视图")])],1),e._v(" "),i("div",{staticClass:"image-mask",on:{mousedown:e.onMouseDown,mouseup:e.onMouseUp}},[i("el-button",{attrs:{type:"primary",round:"",size:"small",icon:"el-icon-view"}},[e._v("遮罩")])],1),e._v(" "),i("div",{ref:"imageWrapper",staticClass:"image-wrapper",staticStyle:{width:"100%",height:"100%"}},[i("el-image",{key:e.campusImage,staticStyle:{width:"100%",height:"100%"},attrs:{src:e.campusImage,fit:"contain"}})],1),e._v(" "),i("div",{ref:"imageMark",staticClass:"image-mark",on:{contextmenu:e.onContextmenu}},e._l(e.regionMap,(function(t,a){return i("div",{key:a,staticClass:"mark-item",style:{left:t.x-3+"px",top:t.y-3+"px"}},[i("el-popover",{attrs:{placement:"top",trigger:"manual"},model:{value:t.visible,callback:function(i){e.$set(t,"visible",i)},expression:"item.visible"}},[i("el-table",{staticStyle:{width:"100%"},attrs:{data:t.b,"max-height":"300",size:"medium","header-cell-style":{padding:0},"cell-style":{padding:"3px 0",lineHeight:"12px"}}},[i("el-table-column",{attrs:{prop:"id",label:"报修单号",align:"center"}}),e._v(" "),i("el-table-column",{attrs:{prop:"xxdd",label:"地址","min-width":"150",align:"center"}}),e._v(" "),i("el-table-column",{attrs:{label:"操作",width:"50",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("el-button",{attrs:{type:"text",size:"small"},on:{click:function(i){return e.handleOpenDetail(t.row)}}},[e._v("查看")])]}}],null,!0)})],1),e._v(" "),i("div",{attrs:{slot:"reference"},on:{click:function(e){t.visible=!t.visible}},slot:"reference"},[i("p",{staticClass:"marker"},[t.countb?i("span",{staticClass:"count"},[e._v(e._s(t.countb))]):e._e(),e._v(" "),i("span",{staticClass:"name"},[e._v(e._s(t.qy))])])]),e._v(" "),i("div",{staticStyle:{"text-align":"right","margin-top":"5px"}},[i("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(i){return e.viewQrcode(t)}}},[e._v("查看二维码")]),e._v(" "),i("el-button",{attrs:{type:"danger",size:"mini"},on:{click:function(i){return e.updateRegion(t)}}},[e._v("修改区域信息")])],1)],1)],1)})),0)]),e._v(" "),"qrcode"===e.showType?i("div",{staticClass:"qrcode-content"},[i("el-table",{key:e.tableKey,staticStyle:{width:"100%"},attrs:{data:e.tableData,height:e.tableHeight,border:"","row-style":{height:"106px"}}},[i("el-table-column",{attrs:{prop:"qid",label:"二维码",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[i("svg",{staticClass:"qrcode",attrs:{xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink"},on:{click:function(t){return e.handleQrcodeZoomIn(a)}}},[i("g",{attrs:{id:a.qrcodeid}})])]}}],null,!1,2689957452)}),e._v(" "),i("el-table-column",{attrs:{prop:"qrcodeurl",label:"二维码链接",align:"center"}}),e._v(" "),i("el-table-column",{attrs:{prop:"xxdd",label:"二维码地址",align:"center"}}),e._v(" "),i("el-table-column",{attrs:{label:"操作",width:"300",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("el-button",{attrs:{type:"primary",plain:"",size:"small"},on:{click:function(i){return e.handleQrcodeEdit(t.row)}}},[e._v("修改")])]}}],null,!1,212201999)})],1)],1):"area"===e.showType?i("div",{staticClass:"qrcode-content"},[i("el-table",{key:e.tableKey,staticStyle:{width:"100%"},attrs:{data:e.region,height:e.tableHeight,border:""}},[i("el-table-column",{attrs:{prop:"xq",label:"校区",align:"center"}}),e._v(" "),i("el-table-column",{attrs:{prop:"qylb",label:"区域类别",align:"center",filters:e.filters,"filter-method":e.filterQylb}}),e._v(" "),i("el-table-column",{attrs:{prop:"qy",label:"区域名称",align:"center"}}),e._v(" "),i("el-table-column",{attrs:{prop:"countb",label:"当前申报单数量",align:"center"}}),e._v(" "),i("el-table-column",{attrs:{label:"操作",width:"300",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[i("el-button",{attrs:{type:"primary",plain:"",size:"small"},on:{click:function(t){return e.viewQrcode(a)}}},[e._v("查看二维码")])]}}])})],1)],1):e._e()]),e._v(" "),"qrcode"===e.showType?i("div",{staticClass:"main-footer"},[i("pagination",{attrs:{total:e.qrcode.length,paging:e.paging},on:{pagination:e.handleSizeChange}})],1):e._e(),e._v(" "),"img"===e.showType?i("vue-context-menu",{staticClass:"context-menu",attrs:{target:e.$refs.imageMark,show:e.contextMenuVisible},on:{"update:show":function(t){return e.contextMenuVisible=t}}},[i("a",{on:{click:e.addRegion}},[e._v("新建区域")])]):e._e(),e._v(" "),i("el-dialog",{staticClass:"jdr-add-dialog",attrs:{title:"新建区域",visible:e.dialogVisibleAdd,width:"450px",center:"",modal:!0,"close-on-click-modal":!1,"append-to-body":""},on:{"update:visible":function(t){e.dialogVisibleAdd=t}}},[i("div",[i("el-form",{ref:"ruleForm",attrs:{model:e.params,rules:e.rules,"label-position":"right","label-width":"100px","status-icon":""}},[i("el-form-item",{attrs:{label:"区域名称",prop:"qy"}},[i("el-input",{attrs:{placeholder:"请填写区域名称",clearable:""},model:{value:e.params.qy,callback:function(t){e.$set(e.params,"qy",t)},expression:"params.qy"}})],1),e._v(" "),i("el-form-item",{attrs:{label:"区域类别",prop:"qylb"}},[i("el-select",{attrs:{clearable:"",placeholder:"请选择区域类别"},model:{value:e.params.qylb,callback:function(t){e.$set(e.params,"qylb",t)},expression:"params.qylb"}},e._l(e.qylb,(function(e,t){return i("el-option",{key:t,attrs:{label:e,value:e}})})),1)],1),e._v(" "),i("el-form-item",{attrs:{label:"区域位置"}},[e.params.x&&e.params.y?i("span",{staticStyle:{"margin-left":"2px"}},[e._v("x: "+e._s(e.params.x)+",  y: "+e._s(e.params.y))]):e._e()])],1)],1),e._v(" "),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{plain:""},on:{click:function(t){e.dialogVisibleAdd=!1}}},[e._v("取 消")]),e._v(" "),i("el-button",{attrs:{type:"primary",plain:""},on:{click:function(t){return e.addRegionSubmit("ruleForm")}}},[e._v("确 定")])],1)]),e._v(" "),i("el-dialog",{staticClass:"jdr-add-dialog",attrs:{title:"修改区域",visible:e.dialogVisibleUpdate,width:"450px",center:"",modal:!1,"append-to-body":"","close-on-click-modal":!1},on:{"update:visible":function(t){e.dialogVisibleUpdate=t}}},[i("div",[i("el-form",{ref:"ruleForm1",attrs:{model:e.updateParams,rules:e.rules,"label-position":"center","label-width":"100px","status-icon":""}},[i("el-form-item",{attrs:{label:"区域名称",prop:"qy"}},[i("el-input",{attrs:{placeholder:"请填写区域名称",clearable:""},model:{value:e.updateParams.qy,callback:function(t){e.$set(e.updateParams,"qy",t)},expression:"updateParams.qy"}})],1),e._v(" "),i("el-form-item",{attrs:{label:"区域类别",prop:"qylb"}},[i("el-select",{attrs:{clearable:"",placeholder:"请选择区域类别"},model:{value:e.updateParams.qylb,callback:function(t){e.$set(e.updateParams,"qylb",t)},expression:"updateParams.qylb"}},e._l(e.qylb,(function(e,t){return i("el-option",{key:t,attrs:{label:e,value:e}})})),1)],1),e._v(" "),i("el-form-item",{attrs:{label:"区域位置",prop:"qywz"}},[i("div",[e.updateParams.x&&e.updateParams.y?i("span",{staticStyle:{"margin-left":"2px"}},[e._v("x: "+e._s(e.updateParams.x)+",  y: "+e._s(e.updateParams.y))]):e._e(),e._v(" "),i("el-button",{staticStyle:{color:"#f00","margin-left":"10px"},attrs:{type:"text"},on:{click:function(t){return e.showRegionUpdateDialog(e.updateParams)}}},[e._v("点我选择位置\n              ")])],1)])],1)],1),e._v(" "),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{plain:""},on:{click:function(t){e.dialogVisibleUpdate=!1}}},[e._v("取 消")]),e._v(" "),i("el-button",{attrs:{type:"primary",plain:""},on:{click:function(t){return e.updateRegionSubmit("ruleForm1")}}},[e._v("确 定")])],1)]),e._v(" "),i("el-dialog",{staticClass:"dialog-posi",staticStyle:{"z-index":"10001"},attrs:{title:e.dialogVisiblePosiTitle,visible:e.dialogVisiblePosi,width:"1300px",top:"50px",center:"","append-to-body":"","close-on-click-modal":!1},on:{"update:visible":function(t){e.dialogVisiblePosi=t}}},[i("div",{staticClass:"el-dialog-div"},[i("image-scale",{attrs:{img:e.campusImage,markPosi:e.markPosi},on:{change:e.setMarkPosi}})],1),e._v(" "),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{plain:""},on:{click:function(t){e.dialogVisiblePosi=!1}}},[e._v("取 消")]),e._v(" "),i("el-button",{attrs:{type:"primary",plain:""},on:{click:function(t){return e.setMarkPosiToParams(e.markPosi)}}},[e._v("确 定")])],1)]),e._v(" "),i("el-dialog",{staticClass:"add-dialog",attrs:{title:"新增二维码",visible:e.dialogVisibleQrcodeAdd,width:"450px",center:"",modal:!1,"append-to-body":"","close-on-click-modal":!1},on:{"update:visible":function(t){e.dialogVisibleQrcodeAdd=t}}},[i("div",[i("el-form",{ref:"addQrcodeForm",attrs:{model:e.addQrcodeParams,rules:e.qrcodeRules,"label-position":"top","label-width":"100px","status-icon":""}},[i("el-form-item",{attrs:{label:"校区:"}},[i("el-input",{attrs:{disabled:""},model:{value:e.xqText,callback:function(t){e.xqText=t},expression:"xqText"}})],1),e._v(" "),i("el-form-item",{attrs:{label:"当前区域:"}},[i("el-input",{attrs:{disabled:""},model:{value:e.qyText,callback:function(t){e.qyText=t},expression:"qyText"}})],1),e._v(" "),i("el-form-item",{attrs:{label:"二维码张贴地址:",prop:"xxdd"}},[i("el-input",{attrs:{type:"textarea",rows:3,placeholder:"请填写二维码张贴地址",clearable:""},model:{value:e.addQrcodeParams.xxdd,callback:function(t){e.$set(e.addQrcodeParams,"xxdd",t)},expression:"addQrcodeParams.xxdd"}})],1)],1)],1),e._v(" "),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{plain:""},on:{click:function(t){e.dialogVisibleQrcodeAdd=!1}}},[e._v("取 消")]),e._v(" "),i("el-button",{attrs:{type:"primary",plain:""},on:{click:function(t){return e.addQrcodeSubmit("addQrcodeForm")}}},[e._v("确 定")])],1)]),e._v(" "),i("el-dialog",{staticClass:"add-dialog",attrs:{title:"修改二维码",visible:e.dialogVisibleQrcodeUpdate,width:"450px",center:"",modal:!1,"append-to-body":"","close-on-click-modal":!1},on:{"update:visible":function(t){e.dialogVisibleQrcodeUpdate=t}}},[i("div",[i("el-form",{ref:"updateQrcodeForm",attrs:{model:e.updateQrcodeParams,rules:e.qrcodeRules,"label-position":"top","label-width":"100px","status-icon":""}},[i("el-form-item",{attrs:{label:"校区:"}},[i("el-input",{attrs:{disabled:""},model:{value:e.xqText,callback:function(t){e.xqText=t},expression:"xqText"}})],1),e._v(" "),i("el-form-item",{attrs:{label:"当前区域:"}},[i("el-input",{attrs:{disabled:""},model:{value:e.qyText,callback:function(t){e.qyText=t},expression:"qyText"}})],1),e._v(" "),i("el-form-item",{attrs:{label:"二维码张贴地址",prop:"xxdd"}},[i("el-input",{attrs:{type:"textarea",rows:3,placeholder:"请填写二维码张贴地址",clearable:""},model:{value:e.updateQrcodeParams.xxdd,callback:function(t){e.$set(e.updateQrcodeParams,"xxdd",t)},expression:"updateQrcodeParams.xxdd"}})],1)],1)],1),e._v(" "),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{plain:""},on:{click:function(t){e.dialogVisibleQrcodeUpdate=!1}}},[e._v("取 消")]),e._v(" "),i("el-button",{attrs:{type:"primary",plain:""},on:{click:function(t){return e.updateQrcodeSubmit("updateQrcodeForm")}}},[e._v("确 定")])],1)]),e._v(" "),i("el-dialog",{staticClass:"preview-dialog",attrs:{title:"二维码预览",visible:e.dialogVisibleQrcodeZoomIn,width:"400px",modal:!1,center:""},on:{"update:visible":function(t){e.dialogVisibleQrcodeZoomIn=t}}},[i("div",{staticClass:"xxdd"},[e._v("地址："+e._s(e.qrcodeXxdd))]),e._v(" "),i("div",{staticClass:"qrcodeZoomIn",attrs:{id:"qrcodeZoomIn"}})]),e._v(" "),i("bxd-dialog",{attrs:{visible:e.dialogVisibleBxd,bxdInfo:e.bxdInfo},on:{"update:visible":function(t){e.dialogVisibleBxd=t}}})],1)},o=[],n=(i("6762"),i("2fdb"),i("28a5"),i("ac6a"),i("5df3"),i("b85c")),s=(i("96cf"),i("1da1")),r=i("5530"),l=i("c4e3"),c=i.n(l),d=i("21a6"),u=i.n(d),m=i("62b3"),p=i("eb09"),f=i("cf45"),h=i("d044"),g=i.n(h),b=i("f121"),v=i("eeb4"),y=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{ref:"imageScaleWrapper",staticClass:"image-scale-wrapper",on:{mousewheel:function(t){return e.onMousewheel(t)}}},[i("div",{ref:"imageWrapper",staticClass:"image-wrapper"},[i("el-image",{staticStyle:{width:"100%",height:"100%"},attrs:{src:e.img,fit:"cover"}})],1),e._v(" "),i("div",{ref:"imageMark",staticClass:"image-mark",on:{contextmenu:function(t){return t.preventDefault(),e.handleClick(t)}}},[i("div",{staticClass:"marker",style:{left:e.markPosi.x+"px",top:e.markPosi.y-30+"px"}},[i("el-image",{staticStyle:{width:"30px",height:"30px"},attrs:{src:e.mark}})],1)]),e._v(" "),i("div",{staticClass:"image-tips"},[i("el-alert",{attrs:{title:"*提示：鼠标拖拽移动图片，鼠标滚轮缩放图片，鼠标右击更改位置，点选后点击下方确定按钮",closable:!1,effect:"dark",type:"error"}})],1),e._v(" "),i("div",{staticClass:"image-posi"},[i("el-alert",{attrs:{title:e.alertTitle,type:"success",closable:!1,effect:"dark"}})],1)])},x=[],q={name:"ImageScale",props:{img:{type:String,required:!0},markPosi:{type:Object}},data:function(){return{mark:i("3639")}},computed:{alertTitle:function(){return"x: ".concat(this.markPosi.x,", y: ").concat(this.markPosi.y)}},mounted:function(){this.onDrag(),this.setWrapperHeight()},methods:{setWrapperHeight:function(){var e=this.$store.getters.config;this.$refs.imageScaleWrapper.style.width=e.mapwidth,this.$refs.imageScaleWrapper.style.height=e.mapheight},onMousewheel:function(e){var t=this.$refs.imageMark,i=this.$refs.imageWrapper,a=getComputedStyle(t).transform,o=parseFloat(a.substring(7).split(",")),n=o||1;n+=e.wheelDelta/500,n>=.5&&(t.style.transform="scale("+n+")",i.style.transform="scale("+n+")")},onDrag:function(){var e=this.$refs.imageMark,t=this.$refs.imageWrapper;e.onmousedown=function(i){var a=i.clientX-e.offsetLeft,o=i.clientY-e.offsetTop;document.onmousemove=function(i){var n=i.clientX-a,s=i.clientY-o,r=e.getBoundingClientRect().width,l=e.getBoundingClientRect().height;n<-r/2&&(n=-r/2),n>r/2&&(n=r/2),s<-l/2&&(s=-l/2),s>l/2&&(s=l/2),e.style.left=n+"px",e.style.top=s+"px",t.style.left=n+"px",t.style.top=s+"px"},document.onmouseup=function(){document.onmousemove=null,document.onmouseup=null}}},handleClick:function(e){this.markPosi.x=e.offsetX,this.markPosi.y=e.offsetY,this.$emit("change",this.markPosi)}}},w=q,_=(i("88b37"),i("2877")),k=Object(_["a"])(w,y,x,!1,null,"1961cf3c",null),P=k.exports,C=i("333d"),T=i("32ed"),M=i("2f62"),Q=(i("4360"),{name:"Region",components:{"vue-context-menu":T["component"],BxdDialog:v["a"],ImageScale:P,Pagination:C["a"]},directives:{drag:{bind:function(e,t){var i=e;i.onmousedown=function(e){var t=e.clientX-i.offsetLeft,a=e.clientY-i.offsetTop;document.onmousemove=function(e){var o=e.clientX-t,n=e.clientY-a;i.style.left=o+"px",i.style.top=n+"px"},document.onmouseup=function(e){document.onmousemove=null,document.onmouseup=null}}}}},data:function(){return{switchAutoMonior:!0,timer:null,baseurl:b["a"].qrcode,campus:b["a"].campus,region:[],regionMap:[],qrcode:[],xq:0,qy:"",showType:"",views:[],tableKey:"",tableHeight:null,qylb:b["a"].area,paging:Object(f["a"])(b["a"].paging),contextMenuVisible:!1,dialogVisibleAdd:!1,dialogVisibleUpdate:!1,dialogVisiblePosi:!1,dialogVisiblePosiTitle:"",dialogVisibleQrcodeAdd:!1,dialogVisibleQrcodeUpdate:!1,dialogVisibleQrcodeZoomIn:!1,dialogVisibleBxd:!1,qrcodeZoomIn:"",qrcodeXxdd:"",bxdInfo:null,imageMaskValue:!1,params:{op:"newqy",qy:"",qylb:"",xq:"",x:"",y:""},updateParams:{op:"upqy",qid:"",qy:"",qylb:"",xq:"",x:"",y:""},qrcodeParams:{op:"selewm",qid:""},addQrcodeParams:{op:"newewm",qid:"",xxdd:""},updateQrcodeParams:{op:"upewm",eid:"",qid:"",xxdd:""},rules:{qy:{required:!0,message:"必填项",trigger:["blur","change"]},qylb:{required:!0,message:"必填项",trigger:["blur","change"]}},qrcodeRules:{xxdd:{required:!0,message:"必填项",trigger:["blur","change"]},qid:{required:!0,message:"必填项",trigger:["blur","change"]}},markPosi:{x:"",y:""}}},computed:Object(r["a"])(Object(r["a"])({},Object(M["b"])(["config"])),{},{campusImage:function(){return"static/image/campus_"+this.params.xq+".jpg"},xqText:function(){var e=this,t=this.campus.filter((function(t){return t.value===e.xq}))[0];return t&&t.text},qyText:function(){var e=this,t=this.region.filter((function(t){return t.id===e.qy}))[0];return t&&t.qy},tableData:function(){var e=this.paging;return this.qrcode.slice((e.currentPage-1)*e.pagesize,e.currentPage*e.pagesize)},filters:function(){return b["a"].area.map((function(e){return{text:e,value:e}}))}}),mounted:function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:this.showType="img",this.cacheViews(),this.queryData(),"img"===this.showType&&this.onDrag(),this.setMainContentWidth(),this.autoMonitor(),this.autoFullScreen();case 7:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),activated:function(){this.autoMonitor()},methods:{autoFullScreen:function(){document.documentElement.RequestFullScreen&&document.documentElement.RequestFullScreen(),console.log(document.documentElement.mozRequestFullScreen),document.documentElement.mozRequestFullScreen&&document.documentElement.mozRequestFullScreen(),document.documentElement.webkitRequestFullScreen&&document.documentElement.webkitRequestFullScreen(),document.documentElement.msRequestFullscreen&&document.documentElement.msRequestFullscreen()},autoMonitor:function(){this.stopMonitor(),this.switchAutoMonior&&(this.timer=setInterval(this.queryData,1e3*this.config.qygltime))},stopMonitor:function(){clearInterval(this.timer),this.timer=null},handleMonitorSwitch:function(){this.switchAutoMonior?(this.autoMonitor(),this.$message.success("自动监测已开启")):(this.stopMonitor(),this.$message.success("自动监测已关闭"))},queryData:function(){this.getRegion(this.xq),Object(p["c"])()},filterParams:function(e){var t={};for(var i in e)(e[i]||0===e[i])&&(t[i]=e[i]);return t},setMainContentWidth:function(){this.$refs.mainContent.style.width=this.config.mapwidth,this.$refs.mainContent.style.height=this.config.mapheight},getRegion:function(e){var t=this;this.params.xq=e,Object(m["c"])(e).then((function(e){e.obj.qylist?(t.region=e.obj.qylist.map((function(e){return e.visible=!1,e})),t.regionMap=t.region.filter((function(e){return e&&e.countb}))):t.$message.error("区域接口异常")}))},addRegion:function(){var e=this;this.contextMenuVisible=!1,this.dialogVisibleAdd=!0,this.$nextTick((function(){e.$refs["ruleForm"].resetFields()}))},addRegionSubmit:function(e){var t=this;this.$refs[e].validate((function(e){e&&Object(m["a"])(t.params).then((function(e){Object(f["c"])(e,"新建成功"),t.dialogVisibleAdd=!1,t.getRegion(t.xq)}))}))},updateRegion:function(e){e.visible=!1,this.dialogVisibleUpdate=!0,this.updateParams={op:"upqy",qid:e.id,qy:e.qy,qylb:e.qylb,xq:e.xq,x:e.x,y:e.y}},updateRegionSubmit:function(e){var t=this;this.$refs[e].validate((function(e){e&&(t.updateParams.xq=t.xq,Object(m["a"])(t.updateParams).then((function(e){var i=Object(f["c"])(e,"修改成功");i&&(t.dialogVisibleUpdate=!1,t.getRegion(t.xq))})))}))},viewQrcode:function(e){this.qy=e.id,this.getQrcode(this.qy)},handleCampusChange:function(e){this.getRegion(e)},downloadQrcodes:function(){var e=this.baseurl;if(this.region.length>0){for(var t=[],i=0;i<this.region.length;i++){var a={fileUrl:e+this.region[i].id,renameFileName:i+1+"_"+this.region[i].xq+"_"+this.region[i].qy+".jpg"};t.push(a)}console.log("所有选中数据的url: ",t),this.filesToRar(t)}else this.$message.error("当前无数据!")},filesToRar:function(e){var t=this,i=this,a=new c.a,o={},s=[];this.$message("正在加载压缩文件！");var r,l=Object(n["a"])(e);try{var d=function(){var e=r.value,t=i.getImgArrayBuffer(e.fileUrl).then((function(t){a.file(e.renameFileName,t,{binary:!0}),o[e.renameFileName]=t}));s.push(t)};for(l.s();!(r=l.n()).done;)d()}catch(m){l.e(m)}finally{l.f()}Promise.all(s).then((function(){a.generateAsync({type:"blob"}).then((function(e){u.a.saveAs(e,"区域二维码打包下载"),i.$message.success("文件压缩完成！"),t.loading=!1}))})).catch((function(e){i.$message.error("文件压缩失败")}))},getImgArrayBuffer:function(e){return new Promise((function(t,i){var a=new XMLHttpRequest;a.open("GET",e,!0),a.responseType="blob",a.onload=function(){200==this.status?t(this.response):i(this.status)},a.send()}))},handleBack:function(){var e=this;this.removeViews(),this.$nextTick((function(){e.tableKey=+new Date}))},onMousewheel:function(e){if("img"===this.showType){this.hideBxdlistPopover();var t=this.$refs.imageMark,i=(this.$refs.imageMarkCopy,this.$refs.imageWrapper),a=getComputedStyle(t).transform,o=parseFloat(a.substring(7).split(",")),n=o||1;n+=e.wheelDelta/500,console.log(n.toFixed(0)),n>=.5&&(t.style.transform="scale("+n+")",i.style.transform="scale("+n+")",this.$nextTick((function(){var e=getComputedStyle(t);console.log(e.width,e.height,e.zoom)})))}},onDrag:function(){var e=this,t=this.$refs.imageMark,i=this.$refs.imageWrapper;t.onmousedown=function(a){var o=a.clientX-t.offsetLeft,n=a.clientY-t.offsetTop;e.hideBxdlistPopover(),document.onmousemove=function(e){var a=e.clientX-o,s=e.clientY-n,r=t.getBoundingClientRect().width,l=t.getBoundingClientRect().height;a<-r/2&&(a=-r/2),a>r/2&&(a=r/2),s<-l/2&&(s=-l/2),s>l/2&&(s=l/2),t.style.left=a+"px",t.style.top=s+"px",i.style.left=a+"px",i.style.top=s+"px"},document.onmouseup=function(){document.onmousemove=null,document.onmouseup=null}}},onContextmenu:function(e){this.params.x=e.offsetX,this.params.y=e.offsetY},handleOpenDetail:function(e){var t=this;Object(m["b"])(e.id).then((function(e){e.obj.blist?(t.dialogVisibleBxd=!0,t.bxdInfo=e.obj.blist[0]):t.$message.error("数据异常")}))},hideBxdlistPopover:function(){this.region.forEach((function(e){return e.visible=!1}))},resetImageView:function(){this.hideBxdlistPopover();var e=this.$refs.imageWrapper,t=this.$refs.imageMark;e.style.transform="scale(1)",e.style.left=0,e.style.top=0,t.style.transform="scale(1)",t.style.left=0,t.style.top=0},showRegionUpdateDialog:function(e){this.setMarkPosi(e),this.dialogVisiblePosi=!0,this.dialogVisiblePosiTitle=e.qy+" -- 选择位置"},setMarkPosi:function(e){this.markPosi.x=e.x,this.markPosi.y=e.y},setMarkPosiToParams:function(e){this.updateParams.x=e.x,this.updateParams.y=e.y,this.dialogVisiblePosi=!1},cacheViews:function(){this.views.includes(this.showType)||this.views.push(this.showType)},removeViews:function(){this.views.pop(),this.showType=this.views[this.views.length-1]},getQrcode:function(e){var t=this;e?setTimeout((function(){t.showType="qrcode",t.cacheViews(),t.$nextTick((function(){t.tableHeight=t.$refs["mainContent"].offsetHeight,t.qrcodeParams["qid"]=e,Object(m["a"])(t.filterParams(t.qrcodeParams)).then((function(e){e.obj.ewmlist&&(t.qrcode=e.obj.ewmlist.map((function(e){return e["qrcodeid"]="qrcode-"+e.id,e["qrcodeurl"]=t.baseurl+e.id,e})),t.$nextTick((function(){t.createQrcode()})))}))}))}),10):this.$message.error("请选择区域")},addQrcode:function(){var e=this;this.qy?(this.dialogVisibleQrcodeAdd=!0,this.$nextTick((function(){e.$refs["addQrcodeForm"].resetFields()}))):this.$message.error("请选择区域")},handleQrcodeEdit:function(e){this.dialogVisibleQrcodeUpdate=!0,this.updateQrcodeParams.eid=e.id,this.updateQrcodeParams.qid=e.qid,this.updateQrcodeParams.xxdd=e.xxdd},addQrcodeSubmit:function(e){var t=this;this.$refs[e].validate((function(e){if(e){t.addQrcodeParams["qid"]=t.qy;var i=t.filterParams(t.addQrcodeParams);Object(m["a"])(i).then((function(e){var i=Object(f["c"])(e,"修改成功");i&&(t.dialogVisibleQrcodeAdd=!1,t.getQrcode(t.qy))}))}}))},updateQrcodeSubmit:function(e){var t=this;this.$refs[e].validate((function(e){if(e){var i=t.filterParams(t.updateQrcodeParams);Object(m["a"])(i).then((function(e){var i=Object(f["c"])(e,"修改成功");i&&(t.dialogVisibleQrcodeUpdate=!1,t.getQrcode(t.qy))}))}}))},handleQrcodeZoomIn:function(e){var t=this;this.dialogVisibleQrcodeZoomIn=!0;var i=e.qrcodeurl,a=e.xxdd;this.$nextTick((function(){t.qrcodeXxdd=a,t.qrcodeZoomIn?(t.qrcodeZoomIn.clear(),t.qrcodeZoomIn.makeCode(i)):t.qrcodeZoomIn=new g.a("qrcodeZoomIn",{width:400,height:400,text:i,colorDark:"#282828",colorLight:"#ffffff"})}))},handleSizeChange:function(){var e=this;this.tableData.forEach((function(e){e.qrcode&&e.qrcode.clear()})),this.$nextTick((function(){e.createQrcode()}))},createQrcode:function(){this.tableData.forEach((function(e){e.qrcode=new g.a(e.qrcodeid,{width:60,height:60,text:e.qrcodeurl,colorDark:"#282828",colorLight:"#ffffff",useSVG:!0})}))},onMouseDown:function(){this.$refs.imageMark.style.background="rgba(25, 64, 93, 0.5)"},onMouseUp:function(){this.$refs.imageMark.style.background="rgba(25, 64, 93, 0)"},showAreaList:function(){var e=this;this.showType="area",this.cacheViews(),this.$nextTick((function(){e.tableHeight=e.$refs["mainContent"].offsetHeight}))},filterQylb:function(e,t){return e===t.qylb}},beforeRouteLeave:function(e,t,i){this.stopMonitor(),i()}}),S=Q,V=(i("55be"),i("9c57"),Object(_["a"])(S,a,o,!1,null,"20e0b1dc",null));t["default"]=V.exports},"96d2":function(e,t,i){},"9c57":function(e,t,i){"use strict";i("1c82")},cf45:function(e,t,i){"use strict";i.d(t,"d",(function(){return o})),i.d(t,"a",(function(){return n})),i.d(t,"c",(function(){return s})),i.d(t,"b",(function(){return r}));i("c5f6");var a=i("5c96");function o(e){e=e||8;for(var t="",i=0;i<e;i++)t+=Math.floor(10*Math.random());return t}function n(e){return e&&JSON.parse(JSON.stringify(e))}function s(e,t){if(t=t||"请求成功！",e.status)if("false"==e.status){var i=Number(e.info);switch(i){case 0:a["Message"].error("未登录授权或无权限！");break;case 1:a["Message"].error("程序错误请刷新！");break;case 2:a["Message"].error("无效参数！");break;case 3:a["Message"].error("缺少传递必要参数！");break;default:a["Message"].error("接口异常，请重试！")}}else a["Message"].success(t);else a["Message"].success(t);return"success"==e.status}function r(e){var t={};for(var i in e)(e[i]||0===e[i])&&(t[i]=e[i]);return t}}}]);